@{
    ViewBag.Title = "Super Admin";
}
<div class="row">
    <div class="card-box table-responsive">
        <div style="float:left">
            <h4 class="header-title m-t-0 m-b-30">Super Admin</h4>
        </div>
        <div style="float:right">
            <button id="AddNewSuperAdminButton" type="button" class="btn btn-inverse waves-effect waves-light m-b-5"> <i class="ti-plus m-r-5"></i> <span>Add SuperAdmin</span> </button>
        </div>
        <div class="col-sm-12">
            <table id="datatable-responsive" name="superAdminListTable" class="table table-striped table-bordered dt-responsive nowrap">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Created At</th>
                        <th>Status</th>
                    </tr>
                </thead>

                <tbody id="SuperAdminList"></tbody>
            </table>
        </div>
    </div><!-- end col -->
</div>
<!-- end row -->

<div class="row" id="panel_detail" style="display:none;">
    <div class="panel-group" id="accordion" 2 role="tablist" aria-multiselectable="true">
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingDetail" style="height: 60px;">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseDetail" aria-expanded="true" aria-controls="collapseDetail">
                </a>
                <div style="float:left">
                    <h4 id="EditingPanelTitle" class="header-title m-t-0 m-b-30">Detail</h4>
                </div>
                <div style="float:right">
                    <button id="ChangePasswordButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:155px;"> <i class="ti-ruler-pencil m-r-5"></i> <span>Change Password</span> </button>
                    <button id="DeleteSuperAdminButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px;"> <i class="ti-trash m-r-5"></i> <span>Delete</span> </button>
                    <button id="UpdateSuperAdminButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px;"> <i class="ti-save m-r-5"></i> <span>Save</span> </button>
                    <button id="CancelAddNewSuperAdminButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px; display:none"> <i class="ti-close m-r-5"></i> <span>Cancel</span> </button>
                    <button id="SubmitNewSuperAdminButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px; display:none"> <i class="ti-location-arrow m-r-5"></i> <span>Submit</span> </button>
                    <button id="CancelChangePasswordButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px; display:none"> <i class="ti-close m-r-5"></i> <span>Cancel</span> </button>
                    <button id="SubmitChangePasswordButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px; display:none"> <i class="ti-location-arrow m-r-5"></i> <span>Submit</span> </button>
                 </div>
            </div>

            <div id="collapseDetail" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingDetail">
                <div class="panel-body">
                    <div class="col-sm-3">
                    </div>
                    <div class="row" style="margin-top: 10px;">
                        <div class="col-sm-2 text-left">
                            <img id="imgPhotoURL" src="/assets/images/default/SuperAdmin.png" class="img-responsive" alt="Photo" style="max-width: 200px; height: inherit; padding-bottom: 15px;">
                        </div>
                        <div class="col-sm-10">
                            <form id="superAdmin-form" class="form-horizontal" role="form" data-toggle="validator">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="inputName" class="col-sm-3 control-label">
                                            First Name(*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cFirstName" type="text" class="form-control" placeholder="First Name" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputShortName" class="col-sm-3 control-label">
                                            Last Name(*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cLastName" type="text" class="form-control" placeholder="Last Name" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail" class="col-sm-3 control-label">
                                            Email (*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cEmail" type="email" class="form-control" placeholder="Email">
                                        </div>
                                    </div>

                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group" id="PasswordDiv" style="display:none">
                                        <label for="inputEmail" class="col-sm-3 control-label">
                                            Password (*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cPassword" type="password" class="form-control" placeholder="Password">
                                        </div>
                                    </div>
                                    <div class="form-group" id="ConfirmedPWDiv" style="display:none">
                                        <label for="inputEmail" class="col-sm-3 control-label">
                                            Confirmed PW (*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cConfirmedPW" type="password" class="form-control" placeholder="Confirmed Password">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmail" class="col-sm-3 control-label">
                                            Deleted (*)
                                        </label>
                                        <div class="col-sm-9">
                                            <select id="cDeletedFlag" class="form-control">
                                                <option value="false">No</option>
                                                <option value="true">Yes</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-3">
                        </div>
                    </div>
                </div>
            </div>

            <!--Change Password Div-->
            <div id="collapseChangePassword" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingDetail">
                <div class="panel-body">
                    <div class="col-sm-3">
                    </div>
                    <div class="row" style="margin-top: 10px;">
                        <div class="col-sm-2 text-left">
                        </div>
                        <div class="col-sm-10">
                            <form id="employee-form" class="form-horizontal" role="form" data-toggle="validator">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label for="inputEmail" class="col-sm-3 control-label">
                                            Old Password(*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cOldPassword" type="password" class="form-control" placeholder="Old Password" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputEmployeeNumber" class="col-sm-3 control-label">
                                            New Password(*)
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="cNewPassword" type="password" class="form-control" placeholder="New Password">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputFirstName" class="col-sm-3 control-label">Confirm New Password (*)</label>
                                        <div class="col-sm-9">
                                            <input id="cConfirmNewPassword" type="password" class="form-control" placeholder="Confirm New Password">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-3">
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of Change Password-->
        </div>
    </div>
</div>
<!-- end row -->

<script type="text/javascript">
    var _superAdminJSONObjs = $.parseJSON(jsonStringFilter('@ViewBag.SuperAdminList'));
    var _selectedSuperAdminId = -1;

    function LoadSuperAdminListIntoTable() {

        var superAdminDataSet = $('#datatable-responsive').DataTable();
        superAdminDataSet.clear().draw(false);

        for (var i in _superAdminJSONObjs) {
            var createdDT = new Date(_superAdminJSONObjs[i].CreatedAt);
            superAdminDataSet.row.add([
                parseInt(i) + 1,
                _superAdminJSONObjs[i].FirstName,
                _superAdminJSONObjs[i].LastName,
                _superAdminJSONObjs[i].Email,
                sfDateToString(createdDT),
                (_superAdminJSONObjs[i].DeletedFlag ? '<i class="zmdi zmdi-circle text-muted"></i>' : '<i class="zmdi zmdi-circle text-success"></i> <span class="name"> Active</span>')
            ]).draw(false);
        }
        superAdminDataSet.columns.adjust().draw();
    }

    function CleanFormInput() {
        $("#cFirstName").val('');
        $('#cLastName').val('');
        $('#cEmail').val('');
        $('#cPassword').val('');
        $('#cConfirmedPW').val('');
        $('#cDeletedFlag').val('false');
        $("#cOldPassword").val('');
        $("#cNewPassword").val('');
        $("#cConfirmNewPassword").val('');
    }

    function RefreshSuperAdminTable() {
        $.ajax({
            type: "POST",
            url: "/SuperAdmin/ReqAction?action=" + "getsuperadmin" + "&t=" + Date.now(),
            data: null,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                _superAdminJSONObjs = $.parseJSON(data.replace(/&quot;/g, '\"'));
                LoadSuperAdminListIntoTable();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                if (XMLHttpRequest.status == 401) {
                    toastr["error"]("Session Expired. Please Re-Login.");
                    setTimeout(function () { sfBacktoHomeIndex(); }, 2000);
                }
                else
                    toastr["error"]("Error");
            }
        });
    }

    function OnSelectSuperAdminItem(superAdminId) {
        $('#panel_detail').css("display", "block");
        $('#EditingPanelTitle').html("Detail");
        _selectedSuperAdminId = superAdminId;
        CleanFormInput();
        for (var i in _superAdminJSONObjs) {
            if (_superAdminJSONObjs[i].Id == _selectedSuperAdminId) {
                $('#cFirstName').val(_superAdminJSONObjs[i].FirstName);
                $('#cLastName').val(_superAdminJSONObjs[i].LastName);
                $('#cEmail').val(_superAdminJSONObjs[i].Email);
                if (_superAdminJSONObjs[i].DeletedFlag)
                    $('#cDeletedFlag').val('true');
                else
                    $('#cDeletedFlag').val('false');
                break;
            }
        }
    }

    function DoSuperAdminTransactionAjax(actionName, Id, postData) {
        var endPoint = "/SuperAdmin/ReqAction?action=" + actionName;
        if (Id >= 0)
            endPoint = endPoint + "&Id=" + Id;
        $.ajax({
            type: "POST",
            url: endPoint + "&t=" + Date.now(),
            data: postData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                RefreshSuperAdminTable();
                _selectedSuperAdminId = -1;
                toastr["success"]("Action Completed. (" + data + ")");
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                if (XMLHttpRequest.status == 401) {
                    toastr["error"]("Session Expired. Please Re-Login.");
                    setTimeout(function () { sfBacktoHomeIndex(); }, 2000);
                }
                else
                    toastr["error"]("Error");
            }
        });
    }

    TableManageButtons.init();

    LoadSuperAdminListIntoTable();

    $(document).ready(function () {
        var table = $('#datatable-responsive').DataTable();
        $('#datatable-responsive #SuperAdminList').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            }
            else {
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
            OnSelectSuperAdminItem(_superAdminJSONObjs[table.row(this).index()].Id);
            SwitchToEditMode();
        });

        function dataValidation(postData, actionMode) {
            if ($("#cFirstName").val().length != 0) {
                postData.append('FirstName', $("#cFirstName").val());
            } else {
                $("#cFirstName").focus();
                swal("Invalid !", "First Name is necessary.");
                return {
                    postData: postData,
                    isValidated: false
                };
            }
            if ($("#cLastName").val().length != 0) {
                postData.append('LastName', $("#cLastName").val());
            } else {
                $("#cLastName").focus();
                swal("Invalid !", "Last Name is necessary.");
                return {
                    postData: postData,
                    isValidated: false
                };
            }
            if ($("#cEmail").val().length != 0) {
                postData.append('Email', $("#cEmail").val());
            } else {
                $("#cEmail").focus();
                swal("Invalid !", "Email is necessary.");
                return {
                    postData: postData,
                    isValidated: false
                };
            }

            if (actionMode.toLowerCase() == 'add') {
                if ($("#cPassword").val().length != 0) {
                    postData.append('Password', $("#cPassword").val());
                } else {
                    $("#cPassword").focus();
                    swal("Invalid !", "Password is necessary.");
                    return {
                        postData: postData,
                        isValidated: false
                    };
                }
            }
            postData.append('DeletedFlag', $("#cDeletedFlag").val());

            return {
                postData: postData,
                isValidated: true
            }
        }
        function SwitchToEditMode() {
            $('#EditingPanelTitle').html("Detail");
            $('#ChangePasswordButton').css("display", "inline");
            $('#DeleteSuperAdminButton').css("display", "inline");
            $('#UpdateSuperAdminButton').css("display", "inline");
            $('#CancelAddNewSuperAdminButton').css("display", "none");
            $('#SubmitNewSuperAdminButton').css("display", "none");

            $('#AddNewSuperAdminButton').css("display", "inline");

            $('#collapseDetail').css("display", "inline");

            $('#PasswordDiv').css("display", "none");
            $('#ConfirmedPWDiv').css("display", "none");

            $('#collapseChangePassword').css("display", "none");
            $('#CancelChangePasswordButton').css("display", "none");
            $('#SubmitChangePasswordButton').css("display", "none");
        }

        $('#AddNewSuperAdminButton').click(function () {
            $('#panel_detail').css("display", "block");
            $('#EditingPanelTitle').html("Add New Super Admin");
            $('#ChangePasswordButton').css("display", "none");
            $('#DeleteSuperAdminButton').css("display", "none");
            $('#UpdateSuperAdminButton').css("display", "none");
            $('#collapseChangePassword').css("display", "none");
            $('#CancelChangePasswordButton').css("display", "none");
            $('#SubmitChangePasswordButton').css("display", "none");
            $('#CancelAddNewSuperAdminButton').css("display", "inline");

            $('#SubmitNewSuperAdminButton').css("display", "inline");

            $('#AddNewSuperAdminButton').css("display", "none");

            $('#PasswordDiv').css("display", "block");
            $('#ConfirmedPWDiv').css("display", "block");

            CleanFormInput();
            $("#cFirstName").focus();
        });

        $('#CancelAddNewSuperAdminButton').click(function () {
            SwitchToEditMode();
            CleanFormInput();
            window.scrollTo(0, 0);
            $('#panel_detail').css("display", "none");
        });
        $("#ChangePasswordButton").click(function () {
            $('#EditingPanelTitle').html("Change Password");
            $('#ChangePasswordButton').css("display", "none");
            $('#DeleteSuperAdminButton').css("display", "none");
            $('#UpdateSuperAdminButton').css("display", "none");
            $('#AddNewSuperAdminButton').css("display", "none");
            $('#CancelAddNewSuperAdminButton').css("display", "none");
            $('#SubmitNewSuperAdminButton').css("display", "none");

            $('#collapseDetail').css("display", "none");

            $('#collapseChangePassword').css("display", "inline");
            $('#CancelChangePasswordButton').css("display", "inline");
            $('#SubmitChangePasswordButton').css("display", "inline");

        });
        $("#CancelChangePasswordButton").click(function () {
            SwitchToEditMode();
        });
        $("#SubmitChangePasswordButton").click(function () {
            if (_selectedSuperAdminId < 0) {
                toastr["error"]("No SuperAdmin Select.");
                return;
            }

            var postData = new FormData();
            if ($("#cOldPassword").val().length != 0) {
                postData.append('OldPassword', $("#cOldPassword").val());
            } else {
                $("#cOldPassword").focus();
                swal("Invalid !", "Please Input Old Password!");
                return;
            }

            if (($("#cNewPassword").val() == $("#cConfirmNewPassword").val()) && ($("#cNewPassword").val().length != 0)) {
                postData.append('NewPassword', $("#cNewPassword").val());
            } else {
                $("#cNewPassword").focus();
                $("#cConfirmNewPassword").val('');
                swal("Invalid !", "Please Confirm Password!");
                return;
            }

            swal({
                title: "Are you sure?",
                text: "",
                type: "success",
                showCancelButton: true,
                confirmButtonClass: 'btn-success waves-effect waves-light',
                confirmButtonText: 'Submit!'
            }, function (isConfirm) {
                if (isConfirm) {
                    DoSuperAdminTransactionAjax("changepassword", _selectedSuperAdminId, postData);
                    SwitchToEditMode();
                    CleanFormInput();
                    window.scrollTo(0, 0);
                }
            });

        });

        $('#SubmitNewSuperAdminButton').click(function () {
            var postData = new FormData();
            var result = dataValidation(postData, "Add");

            if (result.isValidated) {
                swal({
                    title: "Are you sure?",
                    text: "",
                    type: "success",
                    showCancelButton: true,
                    confirmButtonClass: 'btn-success waves-effect waves-light',
                    confirmButtonText: 'Submit!'
                }, function (isConfirm) {
                    if (isConfirm) {
                        DoSuperAdminTransactionAjax("addsuperadmin", -1, result.postData);

                        $('#EditingPanelTitle').html("Detail");
                        $('#DeleteSuperAdminButton').css("display", "inline");
                        $('#UpdateSuperAdminButton').css("display", "inline");
                        $('#CancelAddNewSuperAdminButton').css("display", "none");
                        $('#SubmitNewSuperAdminButton').css("display", "none");

                        $('#AddNewSuperAdminButton').css("display", "inline");

                        $('#PasswordDiv').css("display", "none");
                        $('#ConfirmedPWDiv').css("display", "none");

                        CleanFormInput();
                        window.scrollTo(0, 0);
                    }
                });
            }
        });

        $('#DeleteSuperAdminButton').click(function () {
            if (_selectedSuperAdminId < 0)
                toastr["error"]("No Super Admin Select.");
            else {
                swal({
                    title: "Are you sure?",
                    text: "",
                    type: "error",
                    showCancelButton: true,
                    confirmButtonClass: 'btn-danger waves-effect waves-light',
                    confirmButtonText: 'Delete!'
                }, function (isConfirm) {
                    if (isConfirm) {
                        DoSuperAdminTransactionAjax("deletesuperadmin", _selectedSuperAdminId, null);
                        CleanFormInput();
                        $('#panel_detail').css("display", "none");
                        window.scrollTo(0, 0);
                    }
                });
            }
        });

        $('#UpdateSuperAdminButton').click(function () {
            if (_selectedSuperAdminId < 0)
                toastr["error"]("No Super Admin Select.");
            else {
                var postData = new FormData();
                var result = dataValidation(postData, "Update");

                if (result.isValidated) {
                    swal({
                        title: "Are you sure?",
                        text: "",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: 'btn-warning waves-effect waves-light',
                        confirmButtonText: 'Update!'
                    }, function (isConfirm) {
                        if (isConfirm) {
                            DoSuperAdminTransactionAjax("updatesuperadmin", _selectedSuperAdminId, result.postData);
                            $('#panel_detail').css("display", "none");
                        }
                    });
                }
            }
        });
    });
</script>