
@{
    ViewBag.Title = "Setup / IoT Hub Alias";
}

<div class="row">
    <div class="card-box table-responsive">
        <div style="float:left">
            <h4 class="header-title m-t-0 m-b-30">[[[Setup]]] / [[[IoT Hub Alias]]]</h4>
        </div>
        <div style="float:right">
            <button id="AddNewIoTHubButton" type="button" class="btn btn-inverse waves-effect waves-light m-b-5"> <i class="ti-plus m-r-5"></i> <span>[[[Add]]] [[[IoT Hub Alias]]]</span> </button>
        </div>
        <div class="col-sm-12">
            <table id="datatable-responsive" name="iotHubListTable" class="table table-striped table-bordered dt-responsive nowrap">
                <thead>
                    <tr>
                        <th>[[[No]]]</th>
                        <th>[[[IoT Hub Alias]]]</th>
                        <th>[[[Primary IoT Hub]]]</th>
                        <th>[[[Secondary IoT Hub]]]</th>
                    </tr>
                </thead>

                <tbody id="IoTHubList"></tbody>
            </table>
        </div>
    </div><!-- end col -->
</div>
<!-- end row -->

<div class="row" id="panel_detail" style="display:none;">
    <div class="panel-group" id="accordion" 2 role="tablist" aria-multiselectable="true">
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingDetail" style="height: 60px;">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseDetail" aria-expanded="true" aria-controls="collapseDetail">
                </a>
                <div style="float:left">
                    <h4 id="EditingPanelTitle" class="header-title m-t-0 m-b-30">[[[Detail]]]</h4>
                </div>
                <div style="float:right">
                    <button id="DeleteIoTHubButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px;"> <i class="ti-trash m-r-5"></i> <span>[[[Delete]]]</span> </button>
                    <button id="UpdateIoTHubButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px;"> <i class="ti-save m-r-5"></i> <span>[[[Save]]]</span> </button>
                    <button id="CancelAddNewIoTHubButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px; display:none"> <i class="ti-close m-r-5"></i> <span>[[[Cancel]]]</span> </button>
                    <button id="SubmitNewIoTHubButton" class="btn btn-inverse waves-effect waves-light m-b-5" style="width:92px; display:none"> <i class="ti-location-arrow m-r-5"></i> <span>[[[Submit]]]</span> </button>
                </div>
            </div>

            <div id="collapseDetail" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingDetail">
                <div class="panel-body">
                    <div class="col-sm-3">
                    </div>
                    <div class="row" style="margin-top: 10px;">
                        <div class="col-sm-2 text-left">
                        </div>
                        <div class="col-sm-10">
                            <form id="iotHub-form" class="form-horizontal" role="form" data-toggle="validator">
                                <div class="col-sm-9">
                                    <div id="PrimarySection">
                                        <div class="form-group">
                                            <label for="cIoTHubAlias" class="col-sm-3 control-label">
                                                [[[IoT Hub Alias]]](*)
                                            </label>
                                            <div class="col-sm-9">
                                                <input id="cIoTHubAlias" type="text" class="form-control" placeholder="[[[IoT Hub Alias]]]" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cDescription" class="col-sm-3 control-label">
                                                [[[Description]]]
                                            </label>
                                            <div class="col-sm-9">
                                                <textarea id="cDescription" class="form-control" rows="5"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cPrimaryIoTHubConnectionString" class="col-sm-3 control-label">[[[Primary IoT Hub]]] [[[Connection String]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cPrimaryIoTHubConnectionString" type="text" class="form-control" placeholder="[[[Primary IoT Hub]]] [[[Connection String]]]" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cPrimaryIoTHubConsumeGroup" class="col-sm-3 control-label">[[[Primary IoT Hub]]] [[[Consume Group]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cPrimaryIoTHubConsumeGroup" type="text" class="form-control" placeholder="[[[Primary IoT Hub]]] [[[Consume Group]]]" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cPrimaryIoTHubStorageConnectionString" class="col-sm-3 control-label">[[[Primary IoT Hub]]] [[[Storage]]] [[[Connection String]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cPrimaryIoTHubStorageConnectionString" type="text" class="form-control" placeholder="[[[Primary IoT Hub]]] [[[Storage]]] [[[Connection String]]]" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cPrimaryUploadContainer" class="col-sm-3 control-label">[[[Primary Upload Storage Container]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cPrimaryUploadContainer" type="text" class="form-control" placeholder="[[[Primary Upload Storage Container]]]" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cEnableHAFlag" class="col-sm-3 control-label">[[[Enable IoT Hub Fail Over]]]</label>
                                            <div class="col-sm-9">
                                                <input id="cEnableHAFlag" type="checkbox" data-plugin="switchery" data-color="#00b19d" data-size="small" />
                                            </div>
                                        </div>
                                    </div>
                                    <div id="SecondarySection" style="display:none">
                                        <div class="form-group">
                                            <label for="cSecondaryIoTHubConnectionString" class="col-sm-3 control-label">[[[Secondary IoT Hub]]] [[[Connection String]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cSecondaryIoTHubConnectionString" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cSecondaryIoTHubConsumeGroup" class="col-sm-3 control-label">[[[Secondary IoT Hub]]] [[[Consume Group]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cSecondaryIoTHubConsumeGroup" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cSecondaryIoTHubStorageConnectionString" class="col-sm-3 control-label">[[[Secondary IoT Hub]]] [[[Storage Connection String]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cSecondaryIoTHubStorageConnectionString" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="cSecondaryUploadContainer" class="col-sm-3 control-label">[[[Secondary Upload Storage Container]]] (*)</label>
                                            <div class="col-sm-9">
                                                <input id="cSecondaryUploadContainer" type="text" class="form-control" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-5">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end row -->

<script type="text/javascript">
    var _iotHubJSONObjs = $.parseJSON(jsonStringFilter('@ViewBag.IoTHubList'));
    var _selectedIoTHubId = -1;

    function LoadIoTHubListIntoTable() {

        var iotHubDataSet = $('#datatable-responsive').DataTable();
        iotHubDataSet.clear();

        for (var i in _iotHubJSONObjs) {
            var primaryString = _iotHubJSONObjs[i].P_IoTHubConnectionString;
            if (primaryString!=null && primaryString.length > 55)
                primaryString = _iotHubJSONObjs[i].P_IoTHubConnectionString.substring(0, 54) + "...";
            var secondaryString = _iotHubJSONObjs[i].S_IoTHubConnectionString;
            if (secondaryString!=null && secondaryString.length > 55)
                secondaryString = _iotHubJSONObjs[i].S_IoTHubConnectionString.substring(0, 54) + "...";
            iotHubDataSet.row.add([
                parseInt(i)+1,
                _iotHubJSONObjs[i].IoTHubAlias,
                primaryString,
                secondaryString,
            ]).draw(false);
        }
        iotHubDataSet.columns.adjust().draw();
    }

    function CleanFormInput() {
        $("#cIoTHubAlias").val('');
        $('#cDescription').val('');
        $('#cPrimaryIoTHubEndPoit').val('');
        $('#cPrimaryIoTHubConnectionString').val('');
        $('#cPrimaryIoTHubConsumeGroup').val('');
        $('#cPrimaryIoTHubStorageConnectionString').val('');
        $('#cPrimaryUploadContainer').val('');
        $('#cSecondaryIoTHubConnectionString').val('');
        $('#cSecondaryIoTHubConsumeGroup').val('');
        $('#cSecondaryIoTHubStorageConnectionString').val('');
        $('#cSecondaryUploadContainer').val('');
        $('#SecondarySection').css('display', 'none');
        $('#cEnableHAFlag').prop('checked', false);
    }

    function RefreshIoTHubTable() {
        $.ajax({
            type: "POST",
            url: "/Setup/ReqAction?action=getiothub" + "&t=" + Date.now(),
            data: null,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                _iotHubJSONObjs = $.parseJSON(data.replace(/&quot;/g, '\"'));
                LoadIoTHubListIntoTable();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                if (XMLHttpRequest.status == 401) {
                    toastr["error"]("[[[Session Expired. Please Re-Login]]].");
                    setTimeout(function () { sfBacktoHomeIndex(); }, 2000);
                }
                else
                    toastr["error"]("Error");
            }
        });
    }

    function OnSelectIoTHubItem(iotHubId) {
        $('#panel_detail').css("display", "block");
        $('#EditingPanelTitle').html("[[[Detail]]]");
        _selectedIoTHubId = iotHubId;
        CleanFormInput();
        $('#CancelAddNewIoTHubButton').css("display", "none");
        $('#SubmitNewIoTHubButton').css("display", "none");
        $('#DeleteIoTHubButton').css("display", "inline");
        $('#UpdateIoTHubButton').css("display", "inline");
        $('#AddNewIoTHubButton').css("display", "inline");
        for (var i in _iotHubJSONObjs) {
            if (_iotHubJSONObjs[i].IoTHubAlias == _selectedIoTHubId) {
                $('#cIoTHubAlias').val(_iotHubJSONObjs[i].IoTHubAlias);
                $('#cIoTHubAlias').prop('readonly', true);
                $('#cDescription').val(_iotHubJSONObjs[i].Description);
                $('#cPrimaryIoTHubEndPoit').val(_iotHubJSONObjs[i].P_IoTHubEndPoint);
                $('#cPrimaryIoTHubEndPoit').prop('readonly', true);
                $('#cPrimaryIoTHubConnectionString').val(_iotHubJSONObjs[i].P_IoTHubConnectionString);
                $('#cPrimaryIoTHubConnectionString').prop('readonly', true);
                $('#cPrimaryIoTHubConsumeGroup').val(_iotHubJSONObjs[i].P_EventConsumerGroup);
                $('#cPrimaryIoTHubConsumeGroup').prop('readonly', true);
                $('#cPrimaryIoTHubStorageConnectionString').val(_iotHubJSONObjs[i].P_EventHubStorageConnectionString);
                $('#cPrimaryIoTHubStorageConnectionString').prop('readonly', true);
                $('#cPrimaryUploadContainer').val(_iotHubJSONObjs[i].P_UploadContainer);
                $('#cPrimaryUploadContainer').prop('readonly', true);

                if (_iotHubJSONObjs[i].S_IoTHubEndPoint.length > 0 && _iotHubJSONObjs[i].S_IoTHubEndPoint!='none')
                {
                    $('#SecondarySection').css('display', 'block');
                    $('#cEnableHAFlag').prop('checked', true);
                }
                if (_iotHubJSONObjs[i].S_IoTHubConnectionString!='none')
                {
                    $('#cSecondaryIoTHubConnectionString').val(_iotHubJSONObjs[i].S_IoTHubConnectionString);
                    $('#cSecondaryIoTHubConnectionString').prop('readonly', true);
                }
                if (_iotHubJSONObjs[i].S_EventConsumerGroup != 'none')
                {
                    $('#cSecondaryIoTHubConsumeGroup').val(_iotHubJSONObjs[i].S_EventConsumerGroup);
                    $('#cSecondaryIoTHubConsumeGroup').prop('readonly', true);
                }
                if (_iotHubJSONObjs[i].S_EventHubStorageConnectionString != 'none')
                {
                    $('#cSecondaryIoTHubStorageConnectionString').val(_iotHubJSONObjs[i].S_EventHubStorageConnectionString);
                    $('#cSecondaryIoTHubStorageConnectionString').prop('readonly', true);
                }
                if (_iotHubJSONObjs[i].S_UploadContainer != 'none')
                {
                    $('#cSecondaryUploadContainer').val(_iotHubJSONObjs[i].S_UploadContainer);
                    $('#cSecondaryUploadContainer').prop('readonly', true);
                }
                break;
            }
        }
    }

    function DoIoTHubTransactionAjax(actionName, Id, postData) {
        var endPoint = "/Setup/ReqAction?action=" + actionName;
        if (Id.length > 0)
            endPoint = endPoint + "&Id=" + Id;
        $.ajax({
            type: "POST",
            url: endPoint + "&t=" + Date.now(),
            data: postData,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                RefreshIoTHubTable();
                _selectedIoTHubId = "";
                toastr["success"]("[[[Action Completed]]]. (" + data + ")");
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                if (XMLHttpRequest.status == 401) {
                    toastr["error"]("[[[Session Expired. Please Re-Login]]].");
                    setTimeout(function () { sfBacktoHomeIndex(); }, 2000);
                }
                else
                    toastr["error"]("Error");
            }
        });
    }

    TableManageButtons.init();

    LoadIoTHubListIntoTable();

    $(document).ready(function () {
        var table = $('#datatable-responsive').DataTable();
        $('#datatable-responsive #IoTHubList').on('click', 'tr', function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
            }
            else {
                table.$('tr.selected').removeClass('selected');
                $(this).addClass('selected');
            }
            OnSelectIoTHubItem(_iotHubJSONObjs[table.row(this).index()].IoTHubAlias);
        });

        function dataValidation(postData) {
            var IoTHubAliasExp = /^[A-Za-z\d\s]+$/;
            var IoTHubName = $("#cIoTHubAlias").val().replace(/\s/g, '');
            if (IoTHubName.length == 0) {
                $("#cIoTHubAlias").focus();
                swal("[[[Invalid]]] !", "[[[IoT Hub Alias]]] [[[is necessary]]].");
                return {
                    postData: postData,
                    isValidated: false
                };
            }
            if (IoTHubName.length > 30)
                {
                    $("#cIoTHubAlias").focus();
                    swal("[[[Invalid]]] !", "IoT Hub Alias must shorter than 30 characters.");
                    return {
                        postData: postData,
                        isValidated: false
                    };
            };
            if (!IoTHubName.match(IoTHubAliasExp)) {
                    $("#cIoTHubAlias").focus();
                    swal("[[[Invalid]]] !", "IoT Hub Alias can contain only letters and numbers character.");
                    return {
                        postData: postData,
                        isValidated: false
                    };
            }

            postData.append('IoTHubAlias', IoTHubName);
            $("#cIoTHubAlias").val(IoTHubName);


            if ($("#cDescription").val().length != 0)
                postData.append('Description', $("#cDescription").val());

            //if ($("#cPrimaryIoTHubEndPoit").val().length != 0) {
            //    postData.append('P_IoTHubEndPoint', $("#cPrimaryIoTHubEndPoit").val());
            //} else {
            //    $("#cPrimaryIoTHubEndPoit").focus();
            //    swal("[[[Invalid]]] !", "[[[Primary IoT Hub]]] [[[End Point]]] [[[is necessary]]].");
            //    return {
            //        postData: postData,
            //        isValidated: false
            //    };
            //}
            postData.append('P_IoTHubEndPoint', 'messages/events');


            if ($("#cPrimaryIoTHubConnectionString").val().length != 0) {
                postData.append('P_IoTHubConnectionString', $("#cPrimaryIoTHubConnectionString").val());
            } else {
                $("#cPrimaryIoTHubConnectionString").focus();
                swal("[[[Invalid]]] !", "[[[Primary IoT Hub]]] [[[Connection String]]] [[[is necessary]]].");
                return {
                    postData: postData,
                    isValidated: false
                };
            }

            if ($("#cPrimaryIoTHubConsumeGroup").val().length != 0) {
                postData.append('P_EventConsumerGroup', $("#cPrimaryIoTHubConsumeGroup").val());
            } else {
                $("#cPrimaryIoTHubConsumeGroup").focus();
                swal("[[[Invalid]]] !", "[[[Primary IoT Hub]]] [[[Consume Group]]] [[[is necessary]]].");
                return {
                    postData: postData,
                    isValidated: false
                };
            }

            if ($("#cPrimaryIoTHubStorageConnectionString").val().length != 0) {
                postData.append('P_EventHubStorageConnectionString', $("#cPrimaryIoTHubStorageConnectionString").val());
            } else {
                $("#cPrimaryIoTHubStorageConnectionString").focus();
                swal("[[[Invalid]]] !", "[[[Primary IoT Hub]]] [[[Storage Connection String]]] [[[is necessary]]].");
                return {
                    postData: postData,
                    isValidated: false
                };
            }

            if ($("#cPrimaryUploadContainer").val().length != 0) {
                postData.append('P_UploadContainer', $("#cPrimaryUploadContainer").val());
            } else {
                $("#cPrimaryUploadContainer").focus();
                swal("[[[Invalid]]] !", "[[[Primary Upload Storage Container]]] [[[is necessary]]].");
                return {
                    postData: postData,
                    isValidated: false
                };
            }

            if ($('#cEnableHAFlag').is(":checked")) {
                postData.append('S_IoTHubEndPoint', 'messages/events');

                if ($("#cSecondaryIoTHubConnectionString").val().length != 0) {
                    postData.append('S_IoTHubConnectionString', $("#cSecondaryIoTHubConnectionString").val());
                } else {
                    $("#cSecondaryIoTHubConnectionString").focus();
                    swal("[[[Invalid]]] !", "[[[Secondary IoT Hub]]] [[[Connection String]]] [[[is necessary]]].");
                    return {
                        postData: postData,
                        isValidated: false
                    };
                }

                if ($("#cSecondaryIoTHubConsumeGroup").val().length != 0) {
                    postData.append('S_EventConsumerGroup', $("#cSecondaryIoTHubConsumeGroup").val());
                } else {
                    $("#cSecondaryIoTHubConsumeGroup").focus();
                    swal("[[[Invalid]]] !", "[[[Secondary IoT Hub]]] [[[Consume Group]]] [[[is necessary]]].");
                    return {
                        postData: postData,
                        isValidated: false
                    };
                }

                if ($("#cSecondaryIoTHubStorageConnectionString").val().length != 0) {
                    postData.append('S_EventHubStorageConnectionString', $("#cSecondaryIoTHubStorageConnectionString").val());
                } else {
                    $("#cSecondaryIoTHubStorageConnectionString").focus();
                    swal("[[[Invalid]]] !", "[[[Secondary IoT Hub]]] [[[Storage Connection String]]] [[[is necessary]]].");
                    return {
                        postData: postData,
                        isValidated: false
                    };
                }

                if ($("#cSecondaryUploadContainer").val().length != 0) {
                    postData.append('S_UploadContainer', $("#cSecondaryUploadContainer").val());
                } else {
                    $("#cSecondaryUploadContainer").focus();
                    swal("[[[Invalid]]] !", "[[[Secondary Upload Storage Container]]] [[[is necessary]]].");
                    return {
                        postData: postData,
                        isValidated: false
                    };
                }
            }
            else
            {
                postData.append('S_IoTHubEndPoint', 'none');
                postData.append('S_IoTHubConnectionString', 'none');
                postData.append('S_EventConsumerGroup', 'none');
                postData.append('S_EventHubStorageConnectionString', 'none');
                postData.append('S_UploadContainer', 'none');
            }

            return {
                postData: postData,
                isValidated: true
            }
        }

        $('#cEnableHAFlag').change(function () {
            if ($('#cEnableHAFlag').is(":checked")) {
                $('#SecondarySection').css('display', 'block');
            }
            else
                $('#SecondarySection').css('display', 'none');
        });

        $('#AddNewIoTHubButton').click(function () {
            $('#panel_detail').css("display", "block");

            $('#EditingPanelTitle').html("[[[Add New]]] [[[IoTHub]]]");
            $('#DeleteIoTHubButton').css("display", "none");
            $('#UpdateIoTHubButton').css("display", "none");
            $('#CancelAddNewIoTHubButton').css("display", "inline");

            $('#SubmitNewIoTHubButton').css("display", "inline");

            $('#AddNewIoTHubButton').css("display", "none");
            CleanFormInput();
            $('#cIoTHubAlias').prop('readonly', false);
            $('#cPrimaryIoTHubEndPoit').prop('readonly', false);
            $('#cPrimaryIoTHubConnectionString').prop('readonly', false);
            $('#cPrimaryIoTHubConsumeGroup').prop('readonly', false);
            $('#cPrimaryIoTHubStorageConnectionString').prop('readonly', false);
            $('#cPrimaryUploadContainer').prop('readonly', false);
            $('#cSecondaryIoTHubConnectionString').prop('readonly', false);
            $('#cSecondaryIoTHubConsumeGroup').prop('readonly', false);
            $('#cSecondaryIoTHubStorageConnectionString').prop('readonly', false);
            $('#cSecondaryUploadContainer').prop('readonly', false);
            $("#cIoTHubAlias").focus();
        });

        $('#CancelAddNewIoTHubButton').click(function () {

            $('#panel_detail').css("display", "none");
            $('#EditingPanelTitle').html("[[[Detail]]]");
            $('#DeleteIoTHubButton').css("display", "inline");
            $('#UpdateIoTHubButton').css("display", "inline");
            $('#CancelAddNewIoTHubButton').css("display", "none");
            $('#SubmitNewIoTHubButton').css("display", "none");

            $('#AddNewIoTHubButton').css("display", "inline");
            CleanFormInput();
            window.scrollTo(0, 0);
        });

        $('#SubmitNewIoTHubButton').click(function () {
            var postData = new FormData();
            var result = dataValidation(postData);

            if (result.isValidated) {
                swal({
                    title: "[[[Are you sure]]]?",
                    text: "",
                    type: "success",
                    showCancelButton: true,
                    confirmButtonClass: 'btn-success waves-effect waves-light',
                    confirmButtonText: '[[[Submit]]]!'
                }, function (isConfirm) {
                    if (isConfirm) {
                        DoIoTHubTransactionAjax("addiothub", "", result.postData);

                        $('#panel_detail').css("display", "none");
                        $('#EditingPanelTitle').html("Detail");
                        $('#DeleteIoTHubButton').css("display", "inline");
                        $('#UpdateIoTHubButton').css("display", "inline");
                        $('#CancelAddNewIoTHubButton').css("display", "none");
                        $('#SubmitNewIoTHubButton').css("display", "none");

                        $('#AddNewIoTHubButton').css("display", "inline");

                        CleanFormInput();
                        window.scrollTo(0, 0);
                    }
                });
            }
        });

        $('#DeleteIoTHubButton').click(function () {
            if (_selectedIoTHubId.length == 0)
                toastr["error"]("[[[No IoT Hub Select]]].");
            else {
                swal({
                    title: "[[[Are you sure]]]?",
                    text: "",
                    type: "error",
                    showCancelButton: true,
                    confirmButtonClass: 'btn-danger waves-effect waves-light',
                    confirmButtonText: '[[[Delete]]]!'
                }, function (isConfirm) {
                    if (isConfirm) {
                        DoIoTHubTransactionAjax("deleteiothub", _selectedIoTHubId, null);
                        CleanFormInput();
                        $('#panel_detail').css("display", "none");
                        window.scrollTo(0, 0);
                    }
                });
            }
        });

        $('#UpdateIoTHubButton').click(function () {
            if (_selectedIoTHubId.length == 0)
                toastr["error"]("[[[No IoT Hub Select]]].");
            else {
                var postData = new FormData();
                var result = dataValidation(postData);

                if(result.isValidated){
                    swal({
                        title: "[[[Are you sure]]]?",
                        text: "",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonClass: 'btn-warning waves-effect waves-light',
                        confirmButtonText: '[[[Update]]]!'
                    }, function (isConfirm) {
                        if (isConfirm) {
                            DoIoTHubTransactionAjax("updateiothub", _selectedIoTHubId, result.postData);
                            $('#panel_detail').css("display", "none");
                        }
                    });
                }
            }
        });
    });
</script>
